<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>COB Real-time plotting</title>
        <!-- CSS files -->
        <link href="stylesheets/pure-min.css" rel="stylesheet" type="text/css">
        <link href="stylesheets/base.css" rel="stylesheet" type="text/css">
        <link href="stylesheets/chart-modules.css" rel="stylesheet" type="text/css">

        <!--[if lte IE 8]><script type="text/javascript" src="javascripts/excanvas.min.js"></script><![endif]-->
        <script type="text/javascript" src="javascripts/jquery.min.js"></script>
        <script type="text/javascript" src="javascripts/jquery.flot.min.js"></script>
        <script type="text/javascript" src="javascripts/socket.io.js"></script>
        <script type="text/javascript" src="javascripts/client-server.js"></script>
        <script type="text/javascript">
            $(document).ready(function(){
                // Initialize Flot data points
                var totalPoints = 300;
                var res1 = [];
                var res2 = [];
                function getInitData(res) {
                    // zip the generated y values with the x values
                    for (var i = 0; i < totalPoints; ++i){
                        res.push([i, 0]);
                    }
                    return res;
                }
                var plot1 = $.plot($("#placeholder1"), [ getInitData(res1) ],
                                   {series: {shadowSize: 0},
                               //     yaxis: {min: null, max: null},
                                    xaxis: {show: false}});
                var plot2 = $.plot($("#placeholder2"), [ getInitData(res2) ],
                                   {series: {shadowSize: 0},
                               //     yaxis: {min: -2000, max: 200},
                                    xaxis: {show: false}});

                //Get the URL to hand into the connect call
                var http = location.protocol;
                var slashes = http.concat("//");
                var host = slashes.concat(window.location.hostname);
                var hostport = host.concat(":8000");

                //var socket = io.connect('http://192.168.1.8:8000');
                var socket = io.connect(hostport);
                socket.on('connect', function () {
                    socket.on('message', function (msg) {
                        var chch1=document.getElementById("chchoice1").selectedIndex;
                        var chch2=document.getElementById("chchoice2").selectedIndex;
                        // Convert value to integer
                        //var val = ((parseInt(msg) / 1023)*100);
                        var vals = msg.substring(msg.indexOf('[') + 1,msg.indexOf(']') - 1).split('\t');
                        // update value spans
                        $('#message').html(msg);
                        $('#host').html(hostport);
                        $('#value1').html(vals[chch1]);
                        $('#value2').html(vals[chch2]);

                        // Push new value to Flot Plot
                        res1.push([totalPoints, vals[chch1]]); // push on the end side
                        res1.shift(); // remove first value to maintain 300 points
                        // reinitialize the x axis data points to 0 to 299.
                        for (i=0;i<totalPoints;i++) { res1[i][0] = i; }
                        // Redraw the plot
                        plot1.setData([ res1 ]);
                        plot1.setupGrid();
                        plot1.draw();


                        // Push new value to Flot Plot
                        res2.push([totalPoints, vals[chch2]]); // push on the end side
                        res2.shift(); // remove first value to maintain 300 points
                        // reinitialize the x axis data points to 0 to 299.
                        for (i=0;i<totalPoints;i++) { res2[i][0] = i; }
                        // Redraw the plot
                        plot2.setData([ res2 ]);
                        plot2.setupGrid();
                        plot2.draw();

                        // Update JQuery UI progress bar.
                        //$( "#progressbar" ).progressbar({
                        //     value: val
                    });
                });
            });

        </script>
    </head>


    <body>
        <div role="main">
            Latest Values: <span id="message"></span><br/>
            host: <span id="host"></span><br/>
            Channel
            <select id="chchoice1" >
                <option>1</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
                <option>5</option>
                <option>6</option>
            </select>: <span id="value1"></span><br/>
            <div id="placeholder1" style="width:600px;height:300px;"></div><br/>
            Channel
            <select id="chchoice2" >
                <option>1</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
                <option>5</option>
                <option>6</option>
            </select>: <span id="value2"></span><br/>
            <div id="placeholder2" style="width:600px;height:300px;"></div><br/>
            <a href="/ftp/summary" target="_blank"> Download summary stats for each channel </a><br/>
                <a href="/ftp/datalogs" target="_blank"> Download logfiles </a><br/>
        </div>
    </body>
</html>

